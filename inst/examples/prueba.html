<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>Points</title>

    <link href="points/external/clickme_points.css" rel="stylesheet">
<link href="points/external/bootstrap-tooltip.css" rel="stylesheet">
<script src="points/external/d3.v3.js"></script>
<script src="points/external/d3_aux.js"></script>
<script src="points/external/jquery.min.js"></script>
<script src="points/external/bootstrap-tooltip.v2_3.js"></script>

  </head>

  <style>
  #myplot .plot {
      fill: rgba(25, 25, 25, 0.6);
  }
  #myplot  .grid .tick {
      stroke: lightgrey;
      opacity: 0.7;
  }
  #myplot .grid path {
      stroke-width: 0;
  }
  #myplot .axis path {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
  }

  #myplot .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
  }

  /* for debug */
  #myplot  {
      border:1px solid black;
  }
  </style>

  <body>
    <script type="text/javascript">
    (function() {
      var chromosomes = [
             {"length":197195432,"name":"1"},
             {"length":181748087,"name":"2"},
             {"length":159599783,"name":"3"},
            {"length":155630120,"name":"4"},
            {"length":152537259,"name":"5"},
            {"length":149517037,"name":"6"},
            {"length":152524553,"name":"7"},
            {"length":131738871,"name":"8"},
            {"length":124076172,"name":"9"},
            {"length":129993255,"name":"10"},
            {"length":121843856,"name":"11"},
            {"length":121257530,"name":"12"},
            {"length":120284312,"name":"13"},
            {"length":125194864,"name":"14"},
            {"length":103494974,"name":"15"},
            {"length":98319150,"name":"16"},
            {"length":95272651,"name":"17"},
            {"length":90772031,"name":"18"},
            {"length":61342430,"name":"19"},
            {"length":166650296,"name":"X"}
      ];
      var totalLength = 0;
      var tickValues = [];
      tickValues.push(0);
      $.each(chromosomes, function(index, element, array) {
          chromosomes[index].totalStart = totalLength;
          totalLength += element.length;
          tickValues.push(totalLength);
      });

      var margin = {
          top: 20,
          right: 20,
          bottom: 40,
          left: 45
      };


      //console.log(tickValues);
      //console.log(totalLength);


      var width = 600 - margin.left - margin.right;
      var height = 600 - margin.top - margin.bottom;

      var x = d3.scale.linear().rangeRound([0, width]).domain(d3.extent(tickValues));
      var y = d3.scale.linear().rangeRound([height,0]).domain(d3.extent(tickValues));


      var zoom = d3.behavior.zoom()
          .x(x)
          .y(y)
          .scaleExtent([1, 5])
          .on("zoom", zoomed);

      var svg = d3.select('body')
          .append("svg")
          .attr('id', 'myplot')
          .attr('width', width + margin.left + margin.right)
          .attr('height', height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
          .call(zoom);

      svg.append("rect")
          .attr("width", width)
          .attr("height", height)
          .attr("class", "plot");

      var make_x_axis = function () {
          return d3.svg.axis()
              .scale(x)
              .orient("bottom")
              // .tickValues(tickValues);
      };

      var make_y_axis = function () {
          return d3.svg.axis()
              .scale(y)
              .orient("left")
              // .tickValues(tickValues);
      };

      var xAxis = d3.svg.axis()
          .scale(x)
          .orient("bottom")
          // .tickValues(tickValues)
          .tickFormat(function(d) {
              var ret = bpToChrMBP(d);
              return ret.chr;
          });

      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0, " + height + ")")
          .call(xAxis);

      var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left")
          // .tickValues(tickValues)
          .tickFormat(function(d) {
              var ret = bpToChrMBP(d);
              return ret.chr;
          });

      svg.append("g")
          .attr("class", "y axis")
          .call(yAxis);


      var clip = svg.append("clipPath")
          .attr("id", "clip")
          .append("rect")
          .attr("x", 0)
          .attr("y", 0)
          .attr("width", width)
          .attr("height", height);

      var chartBody = svg.append("g")
          .attr("clip-path", "url(#clip)");

      chartBody.append("g")
          .attr("class", "x grid")
          .attr("transform", "translate(0," + this.height + ")")
          .call(make_x_axis()
          .tickSize(-height, 0, 0)
          // .tickValues(tickValues)
          .tickFormat(""));

      chartBody.append("g")
          .attr("class", "y grid")
          .call(make_y_axis()
          .tickSize(-width, 0, 0)
          // .tickValues(tickValues)
          .tickFormat(""));

      function zoomed() {
          svg.select(".x.axis").call(xAxis);
          svg.select(".y.axis").call(yAxis);

          svg.select(".x.grid")
              .call(make_x_axis()
              .tickSize(-height, 0, 0)
              .tickFormat(""));
          svg.select(".y.grid")
              .call(make_y_axis()
              .tickSize(-width, 0, 0)
              .tickFormat(""));
      }

      function bpToChrMBP(bp) {
          var chr = null;
          var pos = NaN;
          $.each(chromosomes, function(index, element, array) {
              if (element.totalStart <= bp) {
                  chr = element.name;
                  pos = bp - element.totalStart;
                  return;
              }
          });


          return {'chr':chr, 'bp':pos};
      }

    }).call(this);

    </script>
  </body>
</html>